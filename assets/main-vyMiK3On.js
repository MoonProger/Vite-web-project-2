import{s as c,a as B,e as o,b as S}from"./common-C3Dpz0rb.js";const I="pub_259d54bf4a604f0991e8338ff56ce0de",T="https://newsdata.io/api/1/latest",x="us",E=document.getElementById("q"),v=document.getElementById("searchBtn"),D=document.getElementById("refreshBtn"),u=document.getElementById("categorySelect"),h=document.getElementById("newsList"),l=document.getElementById("newsMsg"),L=new URL("/Vite-web-project-2/assets/default_image-wgKfDnch.png",import.meta.url).href,a=document.createElement("button");a.textContent="Загрузить ещё";a.className="load-more-btn";a.style.display="none";document.querySelector(".card").appendChild(a);let g=null,y=[];const R=["business","crime","domestic","education","entertainment","environment","food","health","lifestyle","other","politics","science","sports","technology","top","tourism","world"];function _(e){return e?Array.isArray(e)?e:e.results&&Array.isArray(e.results)?e.results:[]:[]}function M(e){if(!e)return"";const t=new Date(e);if(isNaN(t))return"";const n=t.toLocaleDateString("ru-RU",{day:"2-digit",month:"short",year:"numeric"}),s=t.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"});return{date:n,time:s}}function P(e){return o("span","tag",e)}function U(e){const t=o("article","news-card"),n=o("img","news-img");n.loading="lazy",n.alt=e.title||"Новость",n.src=e.image_url||e.image||L,S(n,L);const s=o("div","news-info"),r=o("div","meta-row"),{date:i,time:f}=M(e.pubDate||e.date),m=o("div","meta-left"),A=o("div","meta-date",`🗓 ${i}`),C=o("div","meta-time",`⏱ ${f}`),b=o("div","meta-publisher",e.source_name||e.source||"Unknown");m.append(A,C),r.append(m,b);const k=o("h3","news-title",e.title||"Без заголовка"),w=o("div","tags-row"),p=Array.isArray(e.category)?e.category:e.categories||[];return p&&p.length&&p.forEach(N=>w.appendChild(P(N))),s.append(r,k,w),t.append(n,s),t.addEventListener("click",()=>{e.link&&window.open(e.link,"_blank","noopener")}),t}function q(e,t=!1){if(t||(h.innerHTML=""),!e||e.length===0){t||c(l,"Ничего не найдено.");return}c(l,""),e.forEach(n=>h.appendChild(U(n)))}function F(){u.innerHTML='<option value="">All Categories</option>',R.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e.charAt(0).toUpperCase()+e.slice(1),u.appendChild(t)})}async function H({q:e="",category:t="",pageToken:n=null}={}){const s=new URLSearchParams;s.set("apikey",I),s.set("country",x),s.set("language","en"),e&&s.set("q",e),t&&s.set("category",t),n&&typeof n=="string"&&s.set("page",n);const r=`${T}?${s.toString()}`;console.log("Fetching:",r);const i=await B(r),f=_(i),m=i&&i.nextPage?i.nextPage:null;return{results:f,nextPage:m}}async function d({reset:e=!0,pageToken:t=null}={}){e&&(h.innerHTML="",y=[]),c(l,"Loading news...");try{const n=E.value.trim(),s=u.value,{results:r,nextPage:i}=await H({q:n,category:s,pageToken:t});if(!r||r.length===0){c(l,"Ничего не найдено."),a.style.display="none";return}c(l,""),g=i||null,y=[...y,...r],q(r,!0),a.style.display=g?"block":"none"}catch(n){console.error("Ошибка NewsData:",n),c(l,"Ошибка загрузки: "+n.message)}}a.addEventListener("click",async()=>{g&&(a.disabled=!0,a.textContent="Загрузка...",await d({reset:!1,pageToken:g}),a.disabled=!1,a.textContent="Загрузить ещё")});v&&v.addEventListener("click",()=>d());D.addEventListener("click",()=>{E.value="",u.value="",d()});u.addEventListener("change",()=>d());E.addEventListener("keyup",e=>{e.key==="Enter"&&d()});F();d();
