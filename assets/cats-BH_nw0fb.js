import{s as o,a as h,b as _}from"./common-DKrip_BD.js";const f="live_GoEF46RcwWwsh5P8iTYddqNnwQHAy7G2BvZzsEZ13zMHlJMBcJzszJ8f8XrCtOOU",g="https://api.thecatapi.com/v1",x="user-123",d=new Map;let w=!1;const v=document.getElementById("catsList"),l=document.getElementById("catsMsg"),b=document.getElementById("refreshCats"),I=document.getElementById("favouritesBtn"),y=document.getElementById("breedSelect"),L="https://via.placeholder.com/800x450?text=No+image";function N(e){const t=document.createElement("div");t.className="card-item";const a=document.createElement("img");a.className="card-media",a.loading="lazy",a.alt=e.id||"cat",a.src=e.url||L,_(a,L);const n=document.createElement("div");if(n.className="card-overlay",e.breeds&&e.breeds[0]&&e.breeds[0].name){const m=document.createElement("div");m.className="title",m.textContent=e.breeds[0].name,n.appendChild(m)}const r=document.createElement("div");r.className="card-actions";const E=document.createElement("div");E.className="left";const i=document.createElement("button");i.className="btn-icon",i.type="button",i.title="Нравится (палец вверх)",i.textContent="👍",i.addEventListener("click",()=>{i.classList.toggle("active"),c.classList.remove("active")});const c=document.createElement("button");c.className="btn-icon",c.type="button",c.title="Не нравится (палец вниз)",c.textContent="👎",c.addEventListener("click",()=>{c.classList.toggle("active"),i.classList.remove("active")}),E.appendChild(i),E.appendChild(c);const s=document.createElement("button");return s.className="btn-icon btn-like",s.type="button",s.title="В избранное",s.textContent="❤",d.has(e.id)&&s.classList.add("active"),s.addEventListener("click",async()=>{var m;if(s.dataset.loading!=="1")try{if(s.dataset.loading="1",d.has(e.id)){const u=d.get(e.id);await h(`${g}/favourites/${encodeURIComponent(u)}`,{method:"DELETE",headers:{"x-api-key":f}}),d.delete(e.id),s.classList.remove("active"),w&&t.parentElement&&t.remove()}else{const u=JSON.stringify({image_id:e.id,sub_id:x}),p=await h(`${g}/favourites`,{method:"POST",headers:{"x-api-key":f,"content-type":"application/json"},body:u}),C=p&&(p.id||(m=p.message)!=null&&m.id)?p.id||p.message.id:null;C!=null?d.set(e.id,C):await k(),s.classList.add("active")}}catch(u){console.error("Ошибка добавления в избранное",u),alert("Не удалось добавить в избранное: "+u.message)}finally{delete s.dataset.loading}}),r.appendChild(E),r.appendChild(s),n.appendChild(r),t.appendChild(a),t.appendChild(n),t}async function A(){try{(await h(`${g}/breeds`,{headers:{"x-api-key":f}})).forEach(t=>{const a=document.createElement("option");a.value=t.id,a.textContent=t.name,y.appendChild(a)})}catch(e){console.error("Ошибка загрузки пород",e)}}async function B(e=""){w=!1,v.innerHTML="",o(l,"Loading...");try{let t=`${g}/images/search?limit=30&size=med`;e&&(t+=`&breed_ids=${encodeURIComponent(e)}`);const[a]=await Promise.all([h(t,{headers:{"x-api-key":f}}),k()]);if(!Array.isArray(a))throw new Error("Неверный формат ответа");o(l,""),a.forEach(n=>v.appendChild(N(n)))}catch(t){o(l,`Error: ${t.message}`),console.error(t)}}async function $(){w=!0,v.innerHTML="",o(l,"Loading favourites...");try{const e=await k(!0);if(!Array.isArray(e))throw new Error("Неверный формат ответа");if(v.innerHTML="",e.length===0){o(l,"Favourites list is empty");return}o(l,""),e.forEach(t=>{const a={id:t.image_id,url:t.image&&t.image.url?t.image.url:L},n=N(a),r=n.querySelector(".btn-like");r&&r.classList.add("active"),v.appendChild(n)})}catch(e){o(l,`Error: ${e.message}`),console.error(e)}}async function k(e=!1){const t=`${g}/favourites?limit=100&order=DESC&attach_image=1&sub_id=${encodeURIComponent(x)}`,a=await h(t,{headers:{"x-api-key":f}});return d.clear(),Array.isArray(a)&&a.forEach(n=>{n&&n.image_id&&n.id!==void 0&&d.set(n.image_id,n.id)}),e?a:void 0}b.addEventListener("click",()=>B(y.value));y.addEventListener("change",()=>B(y.value));I&&I.addEventListener("click",()=>$());A().then(()=>B());
